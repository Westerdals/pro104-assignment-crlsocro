<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arbeidsoversikt</title>
   
    <style>
        h1{
            display: inline;
            margin-left: 40px;
        }
        .entry-field{
            width: 300px;
            height: 320px;
            position: absolute;
            border: 2px solid black;
            padding: 20px;
            margin: 10px;  
            background-color: antiquewhite;
        }
        #enter-task-box{
            left: 10px;
        }
        #enter-member-box{
            left: 360px;
            margin-left: 10px;
            margin-right: 10px;
        }
        #enter-assignment-box{
            left: 710px;
        }
        input, select{
            position: absolute;
            display: inline-block;
            width: 150px;
            right: 40px;
        }  
        .renderbox{
            position: absolute;
            margin: 10px;
            border: 3px solid pink;
            width: 300px;
            top: 400px;
            display: inline-block;
        }
        #task-renderbox{
            left: 20px;
        }
        #member-renderbox{
            left: 360px;
        }
        #assignment-renderbox{
            left: 710px;
        }      
    </style>
 
</head>
<body>
    <!-- Form for lagring av arbeidsoppgaver -->
    <!--  OBS: "Task is finished"-input gir samme value uansett om boksen er checked eller ikke. M책 fiskes! -->
    <div id="enter-task-box" class="entry-field">
        <h1>Arbeidsoppgave</h1>
        <h4>Legg til en arbeidsoppgave</h4>
        <form onsubmit = "addTask(event)">
            <label type="Arbeidsoppgave">Arbeidsoppgave:</label>
            <input type="text" name="work-task">
            <br><br>
            <label type="Published">Start dato:</label>
            <input type="date" name="start-date">
            <br><br>
            <label type="Deadline">Slutt dato:</label>
            <input type="date" name="deadline">
            <br><br>
            <label for="done"> Task is finished</label>
            <input type="checkbox" name="finished" value="task-finished">
            <br><br>
            <input type="submit">
        </form>
    </div>
   
    <!-- Form for lagring av teammedlemmer -->
    <div id="enter-member-box" class="entry-field">
        <h1>Teammedlemmer</h1>
        <h4>Legg til et teammedlem</h4>  
        <form onsubmit = "addMembers(event)">
            <label for="Fornavn">Fornavn:</label>
            <input type="text" name="surname">
            <br><br>
            <label for="Etternavn">Etternavn:</label>
            <input type= "text" name="last-name">
            <br><br>
            <input type="submit">
        </form>
    </div>

    <div id="enter-assignment-box" class="entry-field">
        <h1>Tildelinger</h1>
        <h4>Tildel et teammedlem til en arbeidsoppgave</h4>  
        <form onsubmit="assignMemberToTask(event)">
            
            <label>Arbeidsoppgave:</label>
            <select id="select-task">
            </select>

            <br><br>

            <label>Teammedlem:</label>
            <select id="select-team-member">
            </select>

            <br><br>

            <input type="submit">
        </form>
    </div>
   
    <br>

    <!-- rendring -->
    <div id="member-renderbox" class="renderbox">    
      <div id="teamMemberList"></div>
    </div>    
   
    <div id="task-renderbox" class="renderbox">
      <div id="task-list"></div>
    </div>

    <div id="assignment-renderbox" class="renderbox">
      <div id="assignment-list"></div>
    </div>
 
 
<script>

    listObjectsToAssignments();
    renderTaskList();
    renderTeamMemberList();


    //Funksjon for 책 liste ut alle lagrede objekter i "Tildelinger"-menyen
    function listObjectsToAssignments() {
      const taskSelect = document.getElementById("select-task");
      const teamMemberSelect = document.getElementById("select-team-member");

      const taskList = JSON.parse(localStorage.getItem("taskChecking")) || [];
      const teamMemberList = JSON.parse(localStorage.getItem("teamMember")) || [];
      
      taskSelect.innerHTML = "";
      teamMemberSelect.innerHTML = "";


      for (const task of taskList){
            taskSelect.innerHTML += "<option value=" +  task.workTask + `>${task.workTask}</option>`;
      }

      for (const teamMember of teamMemberList) {
            teamMemberSelect.innerHTML += "<option value=" + `${teamMember.surname} ${teamMember.lastName}">${teamMember.surname} ${teamMember.lastName}</option>`; 
      }  
    }

    //Funksjon for 책 tildele Teammedlem-objekt til Arbeidsoppgave (lage objekt)
    var assignmentChecking = JSON.parse(localStorage.getItem('assignment')) || [];
    function assignMemberToTask() {
        event.preventDefault();

        const assignedTaskValue = document.getElementById("select-task");
        const assignedTeamMemberValue = document.getElementById("select-team-member");

        const taskToBeAssigned = assignedTaskValue.options[assignedTaskValue.selectedIndex].text;
        const memberToBeAssigned = assignedTeamMemberValue.options[assignedTeamMemberValue.selectedIndex].text;
        
        const assignmentObject = {taskToBeAssigned, memberToBeAssigned};
        assignmentChecking.push(assignmentObject);
        localStorage.setItem("assignment", JSON.stringify(assignmentChecking));
        
        const assignmentListEl = document.getElementById("assignment-list");
        assignmentListEl.innerHTML = '';
        //renderAssignmentList();
    }

    //Funksjon for 책 liste ut alle assignments
    function renderassignments() {
      //...
    }


    //Funksjon for lagring av arbeidsoppgave-objekt
    function addTask(event){
       
        event.preventDefault();
 
        //Uthenting av alle verdier i formen (og legger dem inn i variabler)
        var workTask = document.querySelector("[name='work-task']").value;
        var startDate = document.querySelector("[name='start-date']").value;
        var deadline = document.querySelector("[name='deadline']").value;
        var finished = document.querySelector("[value='task-finished']").value;
 
        //Deklarering av objekt
       
        var taskObject = {workTask, startDate, deadline, finished};
        taskChecking.push(taskObject);
        localStorage.setItem("taskChecking", JSON.stringify(taskChecking));
        const taskListEl = document.getElementById("task");
        taskListEl.innerHTML = '';
        renderTaskList();
    }
   
   
    //Funksjon for lagring av teammedlem-objekt
    var memberChecking = JSON.parse(localStorage.getItem('teamMember')) || [];
    function addMembers(event){
       
        event.preventDefault();
 
        //Uthenting av alle verdier i formen (og legger dem inn i variabler)
        const surname = document.querySelector("[name = 'surname']").value;
        const lastName = document.querySelector("[name = 'last-name']").value;
           
        //Deklarering av objekt
        var memberObject = {surname, lastName}
        memberChecking.push(memberObject)
        // console.log(taskChecking)
        localStorage.setItem("teamMember", JSON.stringify(memberChecking))
        const taskListEl = document.getElementById("teamMemberList");
        taskListEl.textContent = ''
        renderTeamMemberList()
 
        //Lagring av objektet i local storage
 
        event.target.reset();
    }
   
 
   
        // render av teammembers
   
        function renderTeamMemberList() {
          const teamMemberList = JSON.parse(localStorage.getItem("teamMember")) || [];
       
          const teamMemberListEl = document.getElementById("teamMemberList");
       
          for (const teamMember of teamMemberList) {
            const teamMemberEl = document.createElement("div");
            teamMemberEl.innerText = teamMember.surname + teamMember.lastName;
            teamMemberListEl.appendChild(teamMemberEl);
 
          }
          listObjectsToAssignments();    
        }       
   
       //render av arbeidsoppgaver
        function renderTaskList() {
          const taskList = JSON.parse(localStorage.getItem("taskChecking")) || [];
   
       
          const taskListEl = document.getElementById("task-list");
       
        // taskList.map( task => {
        //  const taskEl = document.createElement("div");
        //     taskEl.innerText = task.workTask + task.startDate + task.deadline + task.finished;
        //     taskListEl.appendChild(taskEl);
        // })
 
 
        for (const task of taskList) {
            const taskEl = document.createElement("div");
            taskEl.innerText = `${task.workTask} ${task.startDate} ${task.deadline} ${task.finished}`;
            taskListEl.appendChild(taskEl);
 
        } 
        listObjectsToAssignments();   
     }


   
 
 
</script>  
</body>
</html>
